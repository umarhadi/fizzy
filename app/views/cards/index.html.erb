<% @page_title = filter_title @filter %>

<%= render "filters/broadcasts", filter: @filter %>

<% content_for :head do %>
  <%= tag.meta property: "og:title", content: @page_title %>
  <%= tag.meta property: "og:description", content: Account.sole.name %>
  <%= tag.meta property: "og:url", content: cards_url(@filter.as_params) %>
<% end %>

<% content_for :header do %>
  <%= render "cards/index/header", filter: @filter %>
<% end %>

<header class="header" style="--header-actions-width: 7rem;">
  <div class="header__actions header__actions--start">
    <% if collection = @filter.single_collection || Current.user.collections.first %>
      <%= button_to collection_cards_path(collection), method: :post, class: "btn btn--link btn--circle-mobile" do %>
        <%= icon_tag "add" %>
        <span>Add a card</span>
      <% end %>
    <% end %>
  </div>
  <h1 class="header__title" style="view-transistion-name: card-collection-title">
    <span class="overflow-ellipsis"><%= filter_title @filter %></span>
  </h1>
  <div class="header__actions header__actions--end">
    <% if collection = @filter.single_collection %>
      <%= access_involvement_advance_button collection, Current.user %>

      <%= link_to edit_collection_path(collection), class: "btn" do %>
        <%= icon_tag "settings" %>
        <span class="for-screen-reader">Settings for <%= collection.name %></span>
      <% end %>
    <% end %>
  </div>
</header>

<%= render "filters/settings", filter: @filter %>

<%= tag.div data: {
      controller: "drag-and-drop",
      drag_and_drop_dragged_item_class: "drag-and-drop__dragged-item",
      drag_and_drop_hover_container_class: "drag-and-drop__hover-container",
      drag_and_drop_url_value: cards_drops_path(**@filter.as_params),
      action: "
        dragstart->drag-and-drop#dragStart
        dragover->drag-and-drop#dragOver
        drop->drag-and-drop#drop
        dragend->drag-and-drop#dragEnd" } do %>
  <div class="card-columns">
    <%= render "cards/index/engagement/considering", **@considering.to_h %>
    <%= render "cards/index/engagement/doing", **@doing.to_h %>
  </div>

  <%= render "cards/index/engagement/closed", **@closed.to_h %>
<% end %>
